<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Heimautomatisierung mit iBeacons</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="bower_components/normalize-css/normalize.css">
    <link rel="stylesheet" href="style.css">
    <script src="bower_components/jquery/jquery.min.js"></script>
    <script src="script.js"></script>
</head>
<body>

<div id="front">
<p>
ZHAW Zürcher Hochschule für Angewandte Wissenschaften<br/>
Bachelorstudium Informatik<br/>
Semesterarbeit<br/>
Betreuungsperson: Peter Egli
</p>
<h1>Heimautomatisierung mit iBeacons</h1>
<p class="logo">
Logo
</p>
<p>
Fabian Vogler, <a href="mailto:fabian.vogler@gmail.com">fabian.vogler@gmail.com</a><br/>
<span class="version">18. April 2014, Version 0.1</span>
</p>
</div>

<div class="impress chapter">
<p>
&copy; 2014 Fabian Vogler<br/>
Alle Rechte vorbehalten
</p>

<p>
Diese Arbeit entstand im Rahmen der Semesterarbeit an der Zürcher Hochschule 
für Angewandte Wissenschaften (ZHAW) in Zürich.
</p>

<p>
Dieses Dokument wurde in HTML geschrieben und mit Hilfe von 
<a href="http://www.princexml.com/">Prince XML</a> in ein PDF-Dokument 
umgewandelt. Die verwendeten Schriftart ist <em>Helvetica Neue</em>, entwickelt 
von D. Stempel AG und basierend auf <em>Helvetica</em> von Max 
Miedinger.
</p>
</div>

<div id="second">
<h2 class="nonr">Inhaltsverzeichnis</h2>
<ol id="toc"></ol>
</div>

<div class="chapter">
<h2>Einleitung</h2>

<h3>Ausgangslage</h3>
<p>
Heimautomatisierung (engl. Home Automation) bezeichnet die intelligente 
Verknüpfung von Sensoren und anderen technischen Geräten innerhalb der eigenen 
Wohnräume zur Steigerung des Wohnkomforts. Effizientere Technik und 
verbraucherorientierte Produkte haben dies in den letzten Jahren auch für 
normale Konsumenten realisierbar gemacht.
</p>
<p>
Apple hat in der neusten Version seines mobilen Betriebssystems, iOS 7, eine 
neue Möglichkeit zur Lokalisierung des Benutzers in geschlossenen Räumen 
hinzugefügt. Die Technik basiert auf Bluetooth Low Energy, trägt den Namen 
iBeacon und kann verwendet werden um das Betreten oder Verlassen eines Raums 
zu registrieren. Eine Dokumentation des Protokolls wurde von Apple angekündigt 
jedoch noch nicht veröffentlicht.
</p>
<p>
Die Verwendung von bestehenden Geräten, wie Smartphones, ist für die 
Heimautomatisierung interessant, da diese vielfältige Möglichkeiten bieten und 
nicht separat angeschafft werden müssen. Eine optimale Ergänzung dazu stellt 
die Philips hue dar. Es handelt sich dabei um LED-Lampe in Form einer Glühbirne, 
welche über eine API verfügt und so gezielt gesteuert werden kann.
</p>

<h3>Ziele der Arbeit</h3>
<p>
Im Rahmen dieser Semesterarbeit soll analysiert werden, wie die neuen 
Funktionen von iOS 7 optimal verwendet werden können, um eine einfache 
Heimautomatisierung zusammen mit der Philips hue zu ermöglichen. Es soll eine 
zentrale Web-Applikation entwickelt werden, welche die Bewegungen eines 
Benutzers innerhalb der eigenen Wohnräume speichert und die Beleuchtung der 
Räume entsprechend steuert. Der Standort des Benutzers wird dabei von einer 
iPhone-App ermittelt und an die Web-Applikation gemeldet.
</p>

<h3>Aufgabenstellung</h3>
<p>
Im Rahmen dieser Semesterarbeit werden vom Studenten folgende Aufgaben ausgeführt:
</p>
<ol>
<li>Analyse der Funktionalitäten von iBeacon.</li>
<li>Untersuchung des auf Bluetooth Low Energy basierenden Protokolls von iBeacon.</li>
<li>Anforderungsdokumentation für die Automatisierung der Beleuchtung einer Wohnung.</li>
<li>Konzeption und Design des Software-Prototyps zur Umsetzung der dokumentierten Anforderungen.</li>
<li>Implementation eines Prototyps bestehend aus einer iPhone-App zur Lokalisierung des Benutzers und einer Web-Applikation zur Überwachung und Steuerung der Beleuchtung.</li>
<li>Verifikation des Software-Prototyps in einem zweiwöchigen Feldversuch und Analyse der Ergebnisse.</li>
<li>Demonstration des Software-Prototyps.</li>
</ol>

<h3>Vorwort</h3>
<p>
Vermutung, dass Ortung zu ungenau, Problem wurden mit anderen Geräten beobachtet.
Ebenfalls wurde von Apple noch keine offizielle Dokumentation zum iBeacon-Protokoll veröffentlicht.
</p>
<p>
Hue App bietet Steuerung der Beleuchtung über Geo-Location (Wifi, GPS), persönliche
Erfahrung schlecht, Ortunung zu ungenau, Beleuchtung aus und ein während Zuhause.
</p>
</div>


<div class="chapter">
<h2>iBeacon</h2>

<h3>Beschreibung</h3>
<p>
Bei iBeacon handelt es sich um eine von Apple eingetragene Marke und beschreibt 
einen proprietären Technologie für die Lokalisierung eines iPhones mithilfe 
von Bluetooth Low Energy (BLE). Es setzt das Betriebssystem iOS 7 oder neuer, 
sowie ein iPhone mit Bluetooth 4.0 voraus. Das Wort Beacon wird zur Beschreibung 
eines Geräts mit eigener Sromversorgung verwendet, welches einen Standort markiert.
</p>
<p>
<span title="Apple Inc. (2013): iOS: Understanding iBeacon">
Kommt ein iPhone in die Nähe eines Beacons, wird eine auf dem iPhone laufende App 
vom Betriebssystem benachrichtigt. Die App kann dann zusätzlich die Distanz zum 
Beacon abfragen und eigene Aktionen ausführen.</span>
</p>

<h3>Bluetooth Low Energy</h3>

<p>
<span title="Bluetooth SIG, Inc. (2013): Bluetooth Smart">
Bluetooth Low Energy (BLE) ist ein Funkprotokoll und Teil der 
Bluetooth&nbsp;4.0-Spezifikation. Vermarktet wird BLE auch als Bluetooth Smart.
Es wurde speziell für kleine Geräte mit limitierten Akkukapazitäten entwickelt und
kommt deshalb oft auf Smartphones zum Einsatz.</span>
</p>

<p>
Bluetooth Low Energy-Geräte nutzen das Generic Attribute Profile (GATT), um ihre 
Funktionalität zu beschreiben. GATT sieht Services und Characteristics, welche 
ein Gerät im Rahmen einen Profils anbieten kann. Dabei besteht eine 
hierarchische Beziehung zwischen Services und Characteristics. Profile dienen 
zur formellen Gruppierung von mehreren Services.
</p>

<figure>
<img src="images/gatt-profile-hierarchy.png" width="350" class="inline">
<figcaption title="Seite 532, 2.6 GATT Profile Hierarchy, Generic Attribute Profile (GATT), Vol 3, Bluetooth SIG, Inc. (2010): Bluetooth Specification Version 4.0">
GATT Profilhierarchy</figcaption>
</figure>

<h3>Core Bluetooth</h3>
<p>
<span title="Apple Inc. (2013): Core Bluetooth Programming Guide">
Apple bietet mit Core Bluetooth eine vereinfachte Schnittstelle zur Verwendung 
von BLE an, welche die BLE-Protokolle abstrahiert.</span>
</p>

<figure>
<img src="images/core-bluetooth-stack.png" width="160" class="inline">
<figcaption title="Seite 5, About Core Bluetooth, Apple Inc. (2013): Core Bluetooth Programming Guide.">
Aufbau Core Bluetooth</figcaption>
</figure>

<p>Dabei wird bei der Programmierung zwischen zwei Rollen welche nach dem 
Client-Server-Prinzip aufgebaut sind unterschieden: Central und Peripheral.
Ein «Peripheral» (Server) stellt dabei Daten zur Verfügung und kann sich selbst über 
das regelmässige Aussenden von Informationen ankündigen (<em>Advertising</em>). 
Ein «Central» (Client) hingegen sucht nach Peripherals, und verarbeitet 
dessen Informationen in weitern Aktionen. Zum Beispiel kann ein digitaler 
Pulsmesser (Peripheral) mit BLE die aktuelle Herzfrequenz an eine iOS-App (Central) 
übermitteln und die iOS-App zeigt dann diese dem Benutzer an.</span>
</p>

<figure>
<img src="images/ble-roles.png" width="350" class="inline">
<figcaption title="Seite 9, Central and peripheral devices, Apple Inc. (2013): Core Bluetooth Programming Guide.">
Rolen in Bluetooth Low Energy</figcaption>
</figure>

<h3>Analyse iBeaon</h3>

<p>
Um der Funktionsweise von iBeacon auf die Spur zu kommen, wurde mit der 
Einarbeitung in die Grundtechnologie, auf der iBeacon basiert begonnen. Mit dem 
indirekten Ziel, einen Computer als iBeacon zu nutzen, wurde mit der Analyse 
auf einem Mac begonnen. Dazu wurde das bereits beschrieben Core Bluetooth Bibliothek verwendet, 
welche seit Version 10.9 von Mac OS X nicht nur auf iOS zur Verfügung steht. 
Damit sollte ein einfaches BLE-Profile veröffentlicht werden.
</p>

<p>
Anhand des 
Kapitels «Performing Common Peripheral Role Tasks» (Seite 16)
aus der von Apple zur Verfügung gestellten Dokumentation 
«<span title="Apple Inc. (2013): Core Bluetooth Programming Guide">Core Bluetooth Programming Guide</span>» 
wurde ein minimales Programm mithilfe der Programmierumgebung Xcode erstellt, 
welches eigene BLE-Dienste anbietet.
</p>

<figure>
<pre><code>// create manager
CBPeripheralManager *manager = [[CBPeripheralManager alloc] initWithDelegate:self queue:nil options:nil];

// initialize UUIDs
CBUUID *characteristicUUID = [CBUUID UUIDWithString: @"2A38"];
CBUUID *serviceUUID = [CBUUID UUIDWithString: @"180D"];

// create value object
int heartRate = 42;
NSData *value = [NSData dataWithBytes: &heartRate length: sizeof(heartRate)];

// create service with characteristic
CBMutableCharacteristic *characteristic = [[CBMutableCharacteristic alloc] initWithType:characteristicUUID properties:CBCharacteristicPropertyRead value:value permissions:CBAttributePermissionsReadable];
CBMutableService *service = [[CBMutableService alloc] initWithType:serviceUUID primary:YES];
service.characteristics = @[characteristic];

// add service and advertise
[manager addService:service];
[manager startAdvertising:@{ CBAdvertisementDataServiceUUIDsKey : @[serviceUUID] }];
</code></pre>
<figcaption>Beispielanwendung von Core Bluetooth</figcaption>
</figure>

<p>
Konkret wurde mit der Beispiel-Anwendung mit einem Service für Herzfrequenzen mit dem 
UUID <em>180D</em> und mit einer Charakteristik für die Position des Sensors am 
Körper mit der UUID <em>2A38</em> entwickelt.
</p>

<p>
Die iPhone-App 
<span title="Punch Through Design LLC (2013): LightBlue - Bluetooth Low Energy">LightBlue</span> 
bietet die Möglichkeit, eine Verbindung zu beliebigen BLE-Geräte aufzubauen und 
die von den Geräten angebotenen Dienste abzurufen. Die App zeigt zudem die vom 
Gerät versendeten Advertising-Daten an. Die App wurde erfolgreich dazu verwendet, 
die von der Mac-Anwendung publizierten Services und Characteristics zu finden.
</p>

<figure>
<img src="images/screenshot-ble-test-ios.png" width="942">
<figcaption>
Screenshot LightBlue
</figcaption>
</figure>

<p>
Wie im Kapitel <a href="https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/LocationAwarenessPG/RegionMonitoring/RegionMonitoring.html#//apple_ref/doc/uid/TP40009497-CH9-SW12" title="Apple Inc. (2013): Location and Maps Programming Guide">Turn Your iOS Device Into a Beacon</a>
der Dokumentation zu den iBeacons beschrieben, wurde eine einfach iPhone-App 
erstellt, welche die Signale eines iBeacons vom iPhone aussendet. Dazu benötigt 
werden die beiden Bibliotheken <em>CoreBluetooth.framework</em> und <em>CoreLocation.framwork</em>.
</p>

<p>
Jedes Beacon braucht eine eindeutige UUID, anhand welcher es identifiert wird.
Um die Analyse des Protokols zu vereinfachen und die ID einfach auffindbar wurde
die UUID <code>FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF</code> definiert. Als Major 
wurde der Wert <code>00</code> (0) verwendet und als Minor <code>FF</code> (65535).
</p>

<figure>
<pre><code>NSUUID *proximityUUID = [[NSUUID alloc] initWithUUIDString:@"FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF"];

// Create the beacon region.
CLBeaconRegion *beaconRegion = [[CLBeaconRegion alloc] initWithProximityUUID:proximityUUID major:0 minor:65535 identifier:@"ch.zhaw.voglefab.debug"];

// Create a dictionary of advertisement data.
NSDictionary *beaconPeripheralData = [beaconRegion peripheralDataWithMeasuredPower:nil];

// Start advertising your beacon's data.
[self.peripheralManager startAdvertising:beaconPeripheralData];
</code></pre>
<figcaption>
Beispielanwendung von Core Bluetooth
</figcaption>
</figure>

<p>
Diese App wurde auf einem zweiten iPhone installiert und gestartet. Verbindet man 
sich jedoch nun mit LightBlue auf dem ersten iPhone mit dem zweiten iPhone, werden 
in LightBlue nur die Services <em>Battery Service</em> und <em>Current Time Service</em> 
angezeigt - iBeacon wird also kein Service im
GATT-Protokoll. Auch bei den Advertisement-Informationen ist das iBeacon in LightBlue 
nicht sichtbar. Trotz der neuen Erkentniss stellt sich dieser Lösungsansatz 
somit aber als Sackgasse heraus.
</p>

<figure>
<img src="images/screenshot-ble-test-ios-fail.png" width="200" class="inline">
<figcaption>
Screenshot LightBlue iBeacon
</figcaption>
</figure>

<p>
In einem weitern Schritt wurde auch nach Analyse-Tools auf dem Mac gesucht. 
Schliesslich wurde das Software-Packet <span title="Apple Inc. (2013): Hardware IO Tools for Xcode">Hardware IO Tools for Xcode</span> gefunden,
welches von Apple für Entwickler gratis zum Download bereit gestellt wird.
Dieses enthält unter anderem die Tools <em>PacketLogger</em> und 
<em>Bluetooth Explorer</em>, welche für die Analyse der iBeacons verwendet wurden.
</p>

<figure>
<img src="images/screenshot-ble-explorer-1.png" width="942">
<figcaption>
Screenshot Bluetooth Explorer
</figcaption>
</figure>

<p>
Das neue Ziel war nun, die Signale eines iBeacons auf dem Mac zu analysieren. Die 
Software PacketLogger bietet dazu eine Möglichkeit, die vom Computer 
empfangenen BLE-Packete zu analysieren. Scan man mit dem Bluetooth Explorer 
nach BLE-Geräten, werden im PacketLogger die empfangenen BLE Advertisements angezeigt.
</p>

<figure>
<img src="images/screenshot-packetlogger.png" width="1164">
<figcaption>
Screenshot PacketLogger
</figcaption>
</figure>

<p>
Dadurch wurde schlussendlich das Advertisement von der iPhone-App mit den Daten 
gefunden, welche das iBeacon-Signal aussendet. Verwendet wird hier die 
hexadezimale Schreibweise von Octet, zwei Hexzahlen entsprechen also einem Byte 
resp. 8 Bits.
</p>

<figure>
<pre class="inline"><code>02 01 1A 1A FF 4C 00 02 15 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 00 00 FF FF C5
</code></pre>
<figcaption>
Advertisement Daten iBeacon
</figcaption>
</figure>

<p>
Der Aufbau des Advertisements wird auf Kapitel <em>11 Advertising 
and Scan Response data format</em> im Volume 3 der 
<span title="Bluetooth SIG, Inc. (2010): Bluetooth Specification Version 4.0">Bluetooth-Spezifikation</span>
erklärt. Ein Advertisement besteht aus mehreren Elementen, welche eine variable Länge haben.
Am Anfang jedes Elements steht seine eigene Länge gefolgt vom Typ des Elements.
</p>

<figure>
<img src="images/structure-advertising-data.png">
<figcaption title="Seite 375, Bluetooth SIG, Inc. (2010): Bluetooth Specification Version 4.0">
Struktur Advertising and Scan Response</figcaption>
</figure>

<p>
Angewendet auf das empfangene Advertisement ergibt sich folgendes Format für ein 
iBeacon. Gemäss Spezifikation enthalten die ersten zwei Octets des Manufacturer 
Sepcific Data den Company Identifier Code, welcher auf 
<span title="Bluetooth SIG, Inc. (2014): Company Identifiers">der Website</span> 
der Bluetooth SIG dokumentiert ist.
</p>


<figure>
<table class="table-extended inline" width="100%">
<tr><th>Byte</th><th>Beschreibung</th><th>Wert</th></tr>
<tr><td><code>02</code></td><td>Length</td><td>2</td></tr>
<tr><td><code>01</code></td><td>AD Type</td><td>Flags</td></tr>
<tr><td><code>1A</code></td><td>Flags</td><td>LE General Discoverable Mode<br/>Simultaneous LE and BR/EDR (Controller)<br/>Simultaneous LE and BR/EDR (Host)</td></tr>
<tr class="odd"><td><code>1A</code></td><td>Length</td><td>26</td></tr>
<tr class="odd"><td><code>FF</code></td><td>AD Type</td><td>Manufacturer Specific Data</td></tr>
<tr class="odd"><td><code>4C</code></td><td rowspan="2">Company Identifier Code</td><td rowspan="2">Apple, Inc.</td></tr>
<tr class="odd"><td><code>00</code></td></tr>
<tr class="odd"><td><code>02</code></td><td rowspan="2">Fixer Wert</td><td rowspan="2">iBeacon Identifier</td></tr>
<tr class="odd"><td><code>15</code></td></tr>
<tr class="odd"><td><code>FF</code></td><td rowspan="16">iBeacon UUID</td><td rowspan="16">FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF</td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>00</code></td><td rowspan="2">iBeacon Major</td><td rowspan="2">0</td></tr>
<tr class="odd"><td><code>00</code></td></tr>
<tr class="odd"><td><code>FF</code></td><td rowspan="2">iBeacon Minor</td><td rowspan="2">65535</td></tr>
<tr class="odd"><td><code>FF</code></td></tr>
<tr class="odd"><td><code>C5</code></td><td>Fixer Wert</td><td>Measured power</td></tr>
</table>
<figcaption>
Bluetooth Advertisement iBeacon
</figcaption>
</figure>

<p>
Das iBeacon-Format ist also innerhalb der Manufacturer Specific Data im 
BLE-Protokoll gekapselt. Dies konnte auch mit dem Bluetooth Explorer 
verfiziert werden, der ebenfalls die Manufacturer Data anzeigt. Um ein iBeacon zu 
erkennen oder zu simulieren, braucht man also legendlich ein Advertisement mit 
den entsprechenden Manufacturer Specific Data zu senden/empfangen.
</p>

<figure>
<img src="images/screenshot-ble-explorer-2.png" width="942">
<figcaption>
Screenshot Bluetooth Explorer nach Scan
</figcaption>
</figure>


<h3>Messung RSSI</h3>

<p>
RSSI
</p>

<p>
</p>
</div>

<div class="chapter">
<h2>Anforderungen</h2>

<h3>Funktionale Anforderungen</h3>

<figure>
<table class="inline" width="100%">
<colgroup>
    <col width="30%" />
    <col width="70%" />
</colgroup>
<tbody>
<tr>
    <th>Identifier</th>
    <td>UC01</td>
</tr>
<tr>
    <th>Name</th>
    <td>Neues Beacon erfassen</td>
</tr>
<tr>
    <th>Priorität</th>
    <td>mittel</td>
</tr>
<tr>
    <th>Auslöser</th>
    <td>Der Benutzer konfiguriert das System zum ersten Mal oder ist in Besitz eines neuen Beacons gekommen.</td>
</tr>
<tr>
    <th>Beschreibung</th>
    <td>Der Benutzer erfasst ein neues Beacon mit einem eigenen Namen.</td>
</tr>
<tr>
    <th>Vorbedingungen</th>
    <td>
        <ul>
            <li>Der Benutzer muss die UUID sowie den Major- und den Minor-Wert des Beacons kennen.</li>
            <li>Der Benutzer ist in der Anwendung eingeloggt und befindet sich auf der Ansicht zur Konfiguration der Beacons.</li>
        </ul>
    </td>
</tr>
<tr>
    <th>Ergebnis</th>
    <td>Das neue Beacon erscheint auf der Konfigurationsansicht und kann einem Licht zugewiesen werden.</td>
</tr>
<tr>
    <th>Standardablauf</th>
    <td>
        <ul>
            <li>Der Benutzer klickt auf «Beacon hinzufügen».</li>
            <li>Es erscheint ein Formular zur Erfassung des Beacons.</li>
            <li>Der Benutzer füllt den Namen, die UUID, den Major- und den Minor-Wert ein.</li>
            <li>Der Benutzer klickt auf «Beacon speichern».</li>
            <li>Das Beacon wird gespeichert.</li>
            <li>Es wird wieder die Ansicht zur Konfiguration mit einer Erfolgsmeldung über die erfolgreiche Speicherung des Beacons angezeigt.</li>
        </ul>
    </td>
</tr>
<tr>
    <th>Ausnahmen</th>
    <td>
        <ul>
            <li>Es ist bereits ein Beacon mit der selben UUID, Major- und Minor-Werten erfasst; in diesem Fall soll das Beacon nicht gespeichert und eine Fehlermeldung angezeigt werden.</li>
        </ul>
    </td>
</tr>
</tbody>
</table>
<figcaption>UC01 Neues Beacon erfassen</figcaption>
</figure>

<p>
</p>

<figure>
<table class="inline" width="100%">
<colgroup>
    <col width="30%" />
    <col width="70%" />
</colgroup>
<tbody>
<tr>
    <th>Identifier</th>
    <td>UC02</td>
</tr>
<tr>
    <th>Name</th>
    <td>Beacon zu Lichtern zuweisen</td>
</tr>
<tr>
    <th>Priorität</th>
    <td>hoch</td>
</tr>
<tr>
    <th>Auslöser</th>
    <td>Der Benutzer konfiguriert das System zum ersten Mal, ist in Besitz eines neuen Beacons oder einer neuen Lampe gekommen.</td>
</tr>
<tr>
    <th>Beschreibung</th>
    <td>Der Benutzer weisst ein Beacon zu einem oder mehreren Lichtern zu.</td>
</tr>
<tr>
    <th>Vorbedingungen</th>
    <td>
        <ul>
            <li>Es wurde ein Beacon erfasst.</li>
            <li>Es ist mindestens eine Lampe vorhanden.</li>
            <li>Der Benutzer ist in der Anwendung eingeloggt und befindet sich auf der Ansicht zur Konfiguration der Beacons.</li>
        </ul>
    </td>
</tr>
<tr>
    <th>Ergebnis</th>
    <td>Die automatische Steuerung schaltet die ausgewälten Lichter an, sobald der Benutzer in der Nähe des Beacons ist.</td>
</tr>
<tr>
    <th>Standardablauf</th>
    <td>
        <ul>
            <li>Der Benutzer wählt die gewünschten Lichter aus.</li>
            <li>Der Benutzer klickt auf «Zuweisung speichern».</li>
            <li>Die Zuweisung der Lichter zum Beacon wird gespeichert.</li>
            <li>Es wird wieder die Ansicht zur Konfiguration mit einer Erfolgsmeldung über die erfolgreiche Speicherung der Zuweisung angezeigt.</li>
        </ul>
    </td>
</tr>
</tbody>
</table>
<figcaption>UC02 Beacons zu Lichtern zuweisen</figcaption>
</figure>

<p>
</p>

<figure>
<table class="inline" width="100%">
<colgroup>
    <col width="30%" />
    <col width="70%" />
</colgroup>
<tbody>
<tr>
    <th>Identifier</th>
    <td>UC03</td>
</tr>
<tr>
    <th>Name</th>
    <td>Namen eines Beacons ändern</td>
</tr>
<tr>
    <th>Priorität</th>
    <td>tief</td>
</tr>
<tr>
    <th>Auslöser</th>
    <td>Ein Beacon wurde neu positioniert oder es wurde ein Schreibfehler festgestellt.</td>
</tr>
<tr>
    <th>Beschreibung</th>
    <td>Der Benutzer ändert den Namen eines bestehenden Beacons.</td>
</tr>
<tr>
    <th>Vorbedingungen</th>
    <td>
        <ul>
            <li>Das Beacon wurde zuvor erfasst.</li>
            <li>Der Benutzer ist in der Anwendung eingeloggt und befindet sich auf der Ansicht zur Konfiguration der Beacons.</li>
        </ul>
    </td>
</tr>
<tr>
    <th>Ergebnis</th>
    <td>Das Beacon erscheint mit dem geänderten Namen auf der Konfigurationsansicht.</td>
</tr>
<tr>
    <th>Standardablauf</th>
    <td>
        <ul>
            <li>Der Benutzer klickt bei dem gewünschten Beacon auf «Bearbeiten».</li>
            <li>Es erscheint ein Formular mit dem Namen des Beacons.</li>
            <li>Der Benutzer ändert den Namen des Beacons.</li>
            <li>Der Benutzer klickt auf «Beacon speichern».</li>
            <li>Das Beacon wird gespeichert.</li>
            <li>Es wird wieder die Ansicht zur Konfiguration mit einer Erfolgsmeldung über die erfolgreiche Speicherung des Beacons angezeigt.</li>
        </ul>
    </td>
</tr>
</tbody>
</table>
<figcaption>UC03 Namen eines Beacons ändern</figcaption>
</figure>

<p>
</p>

<figure>
<table class="inline" width="100%">
<colgroup>
    <col width="30%" />
    <col width="70%" />
</colgroup>
<tbody>
<tr>
    <th>Identifier</th>
    <td>UC04</td>
</tr>
<tr>
    <th>Name</th>
    <td>Beacon ausblenden</td>
</tr>
<tr>
    <th>Priorität</th>
    <td>tief</td>
</tr>
<tr>
    <th>Auslöser</th>
    <td>Ein Beacon wurde entfernt oder ist nicht mehr relevant.</td>
</tr>
<tr>
    <th>Beschreibung</th>
    <td>Der Benutzer markiert ein Beacon als inaktiv.</td>
</tr>
<tr>
    <th>Vorbedingungen</th>
    <td>
        <ul>
            <li>Das Beacon wurde zuvor erfasst.</li>
            <li>Der Benutzer ist in der Anwendung eingeloggt und befindet sich auf der Ansicht zur Konfiguration der Beacons.</li>
        </ul>
    </td>
</tr>
<tr>
    <th>Ergebnis</th>
    <td>Das Beacon wird in der Konfigurationsansicht in einer separaten Liste aufgeführt und kann nicht mehr Lichtern zugewiesen werden.</td>
</tr>
<tr>
    <th>Standardablauf</th>
    <td>
        <ul>
            <li>Der Benutzer klickt bei dem gewünschten Beacon auf «Bearbeiten».</li>
            <li>Es erscheint ein Formular mit dem Status des Beacons.</li>
            <li>Der Benutzer ändert den Status des Beacons auf «Inaktiv».</li>
            <li>Der Benutzer klickt auf «Beacon speichern».</li>
            <li>Das Beacon wird gespeichert.</li>
            <li>Es wird wieder die Ansicht zur Konfiguration mit einer Erfolgsmeldung über die erfolgreiche Speicherung des Beacons angezeigt.</li>
        </ul>
    </td>
</tr>
</tbody>
</table>
<figcaption>UC04 Beacon ausblenden</figcaption>
</figure>

<p>
</p>

<figure>
<table class="inline" width="100%">
<colgroup>
    <col width="30%" />
    <col width="70%" />
</colgroup>
<tbody>
<tr>
    <th>Identifier</th>
    <td>UC05</td>
</tr>
<tr>
    <th>Name</th>
    <td>Beacon einblenden</td>
</tr>
<tr>
    <th>Priorität</th>
    <td>tief</td>
</tr>
<tr>
    <th>Auslöser</th>
    <td>Ein Beacon wurde wieder relevant nachdem es deaktiviert wurde.</td>
</tr>
<tr>
    <th>Beschreibung</th>
    <td>Der Benutzer markiert ein Beacon als aktiv.</td>
</tr>
<tr>
    <th>Vorbedingungen</th>
    <td>
        <ul>
            <li>Das Beacon wurde zuvor erfasst.</li>
            <li>Das Beacon ist inaktiv.</li>
            <li>Der Benutzer ist in der Anwendung eingeloggt und befindet sich auf der Ansicht zur Konfiguration der Beacons.</li>
        </ul>
    </td>
</tr>
<tr>
    <th>Ergebnis</th>
    <td>Das Beacon wird in der Konfigurationsansicht wieder normale dargestellt und kann Lichtern zugewiesen werden.</td>
</tr>
<tr>
    <th>Standardablauf</th>
    <td>
        <ul>
            <li>Der Benutzer klickt bei dem gewünschten Beacon auf «Bearbeiten».</li>
            <li>Es erscheint ein Formular mit dem Status des Beacons.</li>
            <li>Der Benutzer ändert den Status des Beacons auf «Aktiv».</li>
            <li>Der Benutzer klickt auf «Beacon speichern».</li>
            <li>Das Beacon wird gespeichert.</li>
            <li>Es wird wieder die Ansicht zur Konfiguration mit einer Erfolgsmeldung über die erfolgreiche Speicherung des Beacons angezeigt.</li>
        </ul>
    </td>
</tr>
</tbody>
</table>
<figcaption>UC05 Beacon einblenden</figcaption>
</figure>

Lichter synchronisieren
Licht einschalten: Sobald ein Bereich mit einem Beacon, das mit dem Licht verknüpft ist, betreten wird, soll das Licht aktiviert werden
Licht ausschalten: Wir ein Bereich verlassen, soll das Licht nach 3 Minuten deaktiviert werden
Steuerung pausieren: Als Benutzer muss ich die automatische Steuerung deaktivieren können, damit Gäste nicht im dunkeln stehen

<h3>Nichtfunktionale Anforderungen</h3>


</div>

<div class="chapter">
<h2>Software</h2>

<h3>Lösungsstrategie</h3>

<p>
Das umgesetzte Software besteht aus zwei Komponenten, einer iPhone-App 
sowie einer Web-Applikation. Die Aufgabe der iPhone-App ist legendlich, die 
Position des Benutzers zu ermitteln und diese an die Web-Applikation zu übertragen.
Die Web-Applikation hat eine Anbindung an eine Datenbank 
und speichert dort alle Positionsangaben, steuert die Beleuchtung und stellt die 
gesammelten Informationen für den Benutzer dar.
</p>

<p>
Ein zentrales Element der Web-Applikation ist die <em>Engine</em>, welche die 
aktuellen Positionsdaten analysiert und entscheidet, welche Lichter an- und 
welche ausgeschaltet werden sollen.
</p>

<h3>Datenmodell</h3>

<figure>
<img src="images/erm.png">
<figcaption>
Datenmodell
</figcaption>
</figure>

<p>
</p>

<figure>
<table class="table-extended inline" width="100%">
<tr><th>Tabelle</th><th>Inhalt</th></tr>
<tr><td>beacons</td><td>Sämtliche vom Benutzer erfassten Beacons</td></tr>
<tr><td>beacons_proximities</td><td>Die von der iPhone-App gemessenen Abstände</td></tr>
<tr><td>beacons_states</td><td>Die von der iPhone-App gemeldeten Positionen des Benutzers</td></tr>
<tr><td>beacons_mappings</td><td>Zuweisungen der Beacons zu den Lampen</td></tr>
<tr><td>lights</td><td>Die über die hue API gefundenen Lampen</td></tr>
<tr><td>lights_actions</td><td>Durchgeführte und geplannte Interaktionen mit der hue API zum An- oder Ausschalten der Lampen</td></tr>
<tr><td>lights_log</td><td>Historische Daten über die Brenndauer der Lampen</td></tr>
<tr><td>oauth_clients</td><td>OAuth 2.0 Client-Applikationen (iPhone-Apps)</td></tr>
<tr><td>oauth_tokens</td><td>Authorisierte OAuth-Tokens für die iPhone-App</td></tr>
<tr><td>config</td><td>Systemeinstellungen</td></tr>
</table>
<figcaption>
Tabellen Datenmodell
</figcaption>
</figure>

<h3>Verteilungssicht</h3>

<p>
</p>

<h3>Entwurfsentscheidungen</h3>

<h4>Laufumgebung Engine</h4>

<p>
PHP vs. Objective-C
Internetverbindung
Verteilung
</p>

</div>

<div class="chapter">
<h2>Anhang</h2>

<h3>Software</h3>

<p>
Die während der Arbeit verwendete Software wird hier der Vollständigkeitshalber 
dokumentiert.
</p>

<ul>
<li>Mac OS X 10.9 Build 13A603</li>
<li>Xcode 5.0.2 Build 5A3005</li>
<li>Bluetooth Explorer 4.2.0 Build 4.2.0f2</li>
<li>PacketLogger 4.2.0 Build 4.2.0f2</li>
<li>Prince 9.0 rev 4</li>
<li>MySQL Workbench 6.0 Build 6.0.7.11216</li>
<li>MySQL 5.1.70</li>
<li>PHP 5.4.26</li>
</ul>

<p>Xcode</p>

<h3>Quellenverzeichnis</h3>

<p>
    <span class="ref">Apple Inc. (2013): iOS: Understanding iBeacon</span>. 4. Dezember 2013.
    <a href="http://support.apple.com/kb/HT6048">http://support.apple.com/kb/HT6048</a>
    (abgerufen&nbsp;am&nbsp;19. April&nbsp;2014)
</p>

<p>
    <span class="ref">Bluetooth SIG, Inc. (2013): Bluetooth Smart</span>
    <a href="http://www.bluetooth.com/Pages/Bluetooth-Smart.aspx">http://www.bluetooth.com/Pages/Bluetooth-Smart.aspx</a>
    (abgerufen&nbsp;am&nbsp;19. April&nbsp;2014)
</p>

<p>
    <span class="ref">Bluetooth SIG, Inc. (2014): Company Identifiers</span>
    <a href="https://www.bluetooth.org/en-us/specification/assigned-numbers/company-identifiers">https://www.bluetooth.org/en-us/specification/assigned-numbers/company-identifiers</a>
    (abgerufen&nbsp;am&nbsp;21. April&nbsp;2014)
</p>

<p>
    <span class="ref">Punch Through Design LLC (2013): LightBlue - Bluetooth Low Energy</span>. Version 1.50.
    <a href="https://itunes.apple.com/ch/app/lightblue-bluetooth-low-energy/id557428110?l=en&mt=8">https://itunes.apple.com/ch/app/lightblue-bluetooth-low-energy/id557428110?l=en&mt=8</a>
    (abgerufen&nbsp;am&nbsp;20. April&nbsp;2014)
</p>

<p>
    <span class="ref">Apple Inc. (2013): Hardware IO Tools for Xcode</span>. Veröffentlicht am 22. Oktober 2013.
    <a href="https://developer.apple.com/downloads/index.action?name=hardware%20io">https://developer.apple.com/downloads/index.action?name=hardware%20io</a>
    (abgerufen&nbsp;am&nbsp;20. April&nbsp;2014)
</p>

<p id="https://www.bluetooth.org/docman/handlers/downloaddoc.ashx?doc_id=229737">
    Bluetooth SIG, Inc. (2010): Bluetooth Specification Version 4.0.
    <a href="https://www.bluetooth.org/docman/handlers/downloaddoc.ashx?doc_id=229737">https://www.bluetooth.org/docman/handlers/downloaddoc.ashx?doc_id=229737</a>
    (abgerufen&nbsp;am&nbsp;22. November&nbsp;2013)
</p>

<p>
    <span class="ref">Bluetooth SIG, Inc. (2013): Assigned Numbers</span>
    <a href="https://www.bluetooth.org/en-us/specification/assigned-numbers">https://www.bluetooth.org/en-us/specification/assigned-numbers</a>
    (abgerufen&nbsp;am&nbsp;22. November&nbsp;2013)
</p>

<p id="https://www.bluetooth.org/docman/handlers/downloaddoc.ashx?doc_id=260933">
    Bluetooth SIG, Inc. (2012): Supplement to Bluetooth Core Specification. Version 2.
    <a href="https://www.bluetooth.org/docman/handlers/downloaddoc.ashx?doc_id=260933">https://www.bluetooth.org/docman/handlers/downloaddoc.ashx?doc_id=260933</a>
    (abgerufen&nbsp;am&nbsp;22. November&nbsp;2013)
</p>

<p id="https://developer.apple.com/library/mac/samplecode/HealthThermometer/Introduction/Intro.html#//apple_ref/doc/uid/DTS40011370">
    Apple Inc. (2011): CoreBluetooth: Health Thermometer. Version 1.0.
    <a href="https://developer.apple.com/library/mac/samplecode/HealthThermometer/Introduction/Intro.html#//apple_ref/doc/uid/DTS40011370">https://developer.apple.com/library/mac/samplecode/HealthThermometer/Introduction/Intro.html#//apple_ref/doc/uid/DTS40011370</a> 
    (abgerufen&nbsp;am&nbsp;20.&nbsp;November&nbsp;2013)
</p>

<p>
    <span class="ref">Apple Inc. (2013): Location and Maps Programming Guide</span>
    <a href="https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/LocationAwarenessPG/Introduction/Introduction.html#//apple_ref/doc/uid/TP40009497">https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/LocationAwarenessPG/Introduction/Introduction.html#//apple_ref/doc/uid/TP40009497</a>
    (abgerufen&nbsp;am&nbsp;24.&nbsp;November&nbsp;2013)
</p>

<p>
    <span class="ref">Apple Inc. (2013): Core Bluetooth Programming Guide</span>. 18. September 2013.
    <a href="https://developer.apple.com/library/ios/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/CoreBluetooth_concepts.pdf">https://developer.apple.com/library/ios/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/CoreBluetooth_concepts.pdf</a>
    (abgerufen&nbsp;am&nbsp;20.&nbsp;November&nbsp;2013)
</p>

<p id="https://github.com/lgaches/BeaconEmitter">
    Laurent Gaches (2013): BeaconEmitter.
    <a href="https://github.com/lgaches/BeaconEmitter">https://github.com/lgaches/BeaconEmitter</a> 
    (abgerufen&nbsp;am&nbsp;20.&nbsp;November&nbsp;2013)
</p>

<ol id="sources"></ol>

<h3>Literaturverzeichnis</h3>

<h3 class="break">Abbildungsverzeichnis</h3>

<ul id="figures"></ul>
</div>

<footer>&#160;</footer>

</body>
</html>
